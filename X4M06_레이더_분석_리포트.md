# X4M06 레이더 신호 수집 및 샘플 코드 분석 리포트

## 1. 개요

X4M06는 Novelda AS에서 개발한 60GHz 대역 초광대역(UWB) 레이더 모듈로, 비접촉 방식으로 호흡, 심박수, 움직임 감지 등의 생체 신호를 측정할 수 있습니다. Python 환경에서 PyModuleConnector 라이브러리를 통해 레이더 데이터를 수집하고 처리할 수 있습니다.

## 2. Python 환경 설정

### 2.1 필요 라이브러리
- `pymoduleconnector`: X4M06 모듈과의 통신을 위한 메인 라이브러리
- `numpy`: 수치 계산 및 배열 처리
- `matplotlib`: 데이터 시각화
- `optparse`: 명령행 인자 처리

### 2.2 설치 방법
```bash
# pymoduleconnector 설치 (제공된 패키지 디렉토리에서)
python setup.py install

# 추가 의존성 설치
pip install numpy matplotlib
```

## 3. 레이더 신호 수집 방법

### 3.1 기본 연결 및 초기화

```python
from pymoduleconnector import ModuleConnector

# 시리얼 연결 (COM 포트)
device_name = "COM3"  # Windows
# device_name = "/dev/ttyACM0"  # Linux

# 모듈 연결
mc = ModuleConnector(device_name)
xep = mc.get_xep()  # XEP (XeThru Embedded Protocol) 인터페이스 획득
```

### 3.2 레이더 파라미터 설정

```python
# 모듈 리셋
xep.module_reset()

# DAC 범위 설정 (디지털-아날로그 변환기)
xep.x4driver_set_dac_min(900)
xep.x4driver_set_dac_max(1150)

# 적분 및 펄스 설정
xep.x4driver_set_iterations(16)          # 평균화 횟수
xep.x4driver_set_pulses_per_step(26)     # 스텝당 펄스 수

# 송신 전력 설정
xep.x4driver_set_tx_power(2)

# 프레임 영역 설정 (측정 범위)
xep.x4driver_set_frame_area(2, 6)        # 시작: 2m, 끝: 6m
xep.x4driver_set_frame_area_offset(0.18) # 오프셋

# 중심 주파수 및 PRF 설정
xep.x4driver_set_tx_center_frequency(3)
xep.x4driver_set_prf_div(16)

# 베이스밴드/RF 모드 선택
xep.x4driver_set_downconversion(1)  # 1: 베이스밴드, 0: RF
```

### 3.3 데이터 스트리밍 시작

```python
# FPS 설정 및 스트리밍 시작
FPS = 20
xep.x4driver_set_fps(FPS)

# 데이터 읽기
def read_frame():
    """프레임 데이터 읽기"""
    d = xep.read_message_data_float()
    frame = np.array(d.data)
    
    # 베이스밴드 모드인 경우 복소수 배열로 변환
    if baseband_mode:
        n = len(frame)
        frame = frame[:n//2] + 1j*frame[n//2:]
    
    return frame

# 버퍼 클리어
def clear_buffer():
    """프레임 버퍼 클리어"""
    while xep.peek_message_data_float():
        _ = xep.read_message_data_float()
```

## 4. 샘플 코드 분석

### 4.1 simple_xep_plot2.py
**목적**: 기본적인 레이더 데이터 실시간 플롯팅

**주요 기능**:
- 레이더 모듈 초기화 및 파라미터 설정
- 실시간 데이터 수집 및 matplotlib을 이용한 시각화
- RF/베이스밴드 모드 지원

**핵심 코드 구조**:
```python
# 모듈 리셋 및 설정
reset(device_name)
mc = ModuleConnector(device_name)
r = mc.get_xep()

# 파라미터 설정
r.x4driver_set_dac_min(900)
r.x4driver_set_dac_max(1150)
r.x4driver_set_iterations(16)
r.x4driver_set_pulses_per_step(26)

# 애니메이션을 통한 실시간 플롯
ani = FuncAnimation(fig, animate, interval=FPS)
plt.show()
```

### 4.2 XEP_X4M200_X4M300_plot_record_playback_radar_raw_data.py
**목적**: 레이더 원시 데이터의 기록, 재생 및 시각화

**주요 기능**:
- X4M200/X4M300 모듈 지원
- 데이터 녹화 및 재생 기능
- 메타데이터 파일 생성
- RF/베이스밴드 모드 지원

**핵심 특징**:
- 수동 모드 설정을 통한 직접 제어
- 데이터 레코더를 통한 파일 저장
- 재생 모드에서 루프 재생 지원

### 4.3 X4M200_X4M300_printout_infromation.py
**목적**: 모듈 정보 확인 및 시스템 상태 점검

**주요 기능**:
- 모듈 버전, 시리얼 번호 등 시스템 정보 출력
- Ping/Pong 테스트를 통한 통신 확인
- 드라이버 초기화 및 파라미터 설정 테스트

**시스템 정보 조회**:
```python
print('ItemNumber =', xep.get_system_info(XTID_SSIC_ITEMNUMBER))
print('FirmWareID =', xep.get_system_info(XTID_SSIC_FIRMWAREID))
print('Version =', xep.get_system_info(XTID_SSIC_VERSION))
print('SerialNumber =', xep.get_system_info(XTID_SSIC_SERIALNUMBER))
```

### 4.4 X4M200_X4M300_printout_pulsedoppler_data.py
**목적**: 펄스-도플러 데이터 수집 및 처리

**주요 기능**:
- 펄스-도플러 텔레그램 스트리밍
- Range-Doppler 매트릭스 조립
- 움직임 감지 및 속도 측정

## 5. 데이터 타입 및 처리

### 5.1 데이터 타입
- **RF 데이터**: 원시 레이더 신호 (실수값)
- **베이스밴드 데이터**: 다운컨버트된 복소수 신호 (I/Q)
- **펄스-도플러 데이터**: 속도 정보를 포함한 처리된 데이터

### 5.2 신호 처리
```python
# 베이스밴드 데이터 처리
if baseband:
    n = len(frame)
    i_data = frame[:n//2]      # I 채널
    q_data = frame[n//2:]      # Q 채널
    complex_frame = i_data + 1j*q_data  # 복소수 신호
    magnitude = abs(complex_frame)      # 크기
    phase = np.angle(complex_frame)     # 위상
```

## 6. 통신 방법

### 6.1 지원되는 연결 방식
- **시리얼 통신**: USB-Serial, UART
- **TCP/IP**: 네트워크를 통한 원격 연결
- **ISH**: Intel Sensor Hub 인터페이스

### 6.2 연결 예제
```python
# 시리얼 연결
mc = ModuleConnector("COM3")

# TCP/IP 연결
mc = ModuleConnector("tcp://192.168.1.169:3000")

# ISH 연결
mc = ModuleConnector("ish://")
```

## 7. 실제 활용 예제

### 7.1 호흡 감지
```python
def detect_breathing(device_name):
    mc = ModuleConnector(device_name)
    xep = mc.get_xep()
    
    # 호흡 감지에 최적화된 설정
    xep.x4driver_set_frame_area(0.4, 2.0)  # 근거리 감지
    xep.x4driver_set_iterations(32)        # 높은 평균화
    xep.x4driver_set_fps(10)               # 낮은 프레임율
    
    # 데이터 수집 및 처리
    while True:
        frame = read_frame()
        # 호흡 신호 처리 로직
        breathing_rate = process_breathing(frame)
        print(f"호흡수: {breathing_rate} bpm")
```

### 7.2 움직임 감지
```python
def detect_movement(device_name):
    mc = ModuleConnector(device_name)
    xep = mc.get_xep()
    
    # 움직임 감지 설정
    xep.x4driver_set_frame_area(1.0, 5.0)  # 넓은 범위
    xep.x4driver_set_fps(20)               # 높은 프레임율
    
    previous_frame = None
    while True:
        frame = read_frame()
        if previous_frame is not None:
            movement = detect_frame_difference(frame, previous_frame)
            if movement > threshold:
                print("움직임 감지!")
        previous_frame = frame
```

## 8. 주요 API 함수 정리

### 8.1 연결 및 초기화
| 함수 | 설명 |
|------|------|
| `ModuleConnector(device_name)` | 모듈 연결 |
| `mc.get_xep()` | XEP 인터페이스 획득 |
| `xep.module_reset()` | 모듈 리셋 |
| `xep.ping()` | 통신 테스트 |

### 8.2 파라미터 설정
| 함수 | 설명 |
|------|------|
| `xep.x4driver_set_dac_min(value)` | DAC 최소값 설정 |
| `xep.x4driver_set_dac_max(value)` | DAC 최대값 설정 |
| `xep.x4driver_set_iterations(value)` | 평균화 횟수 설정 |
| `xep.x4driver_set_pulses_per_step(value)` | 스텝당 펄스 수 설정 |
| `xep.x4driver_set_frame_area(start, end)` | 측정 범위 설정 |
| `xep.x4driver_set_fps(value)` | 프레임율 설정 |
| `xep.x4driver_set_downconversion(mode)` | 베이스밴드/RF 모드 설정 |

### 8.3 데이터 수집
| 함수 | 설명 |
|------|------|
| `xep.peek_message_data_float()` | 데이터 버퍼 확인 |
| `xep.read_message_data_float()` | Float 데이터 읽기 |
| `xep.get_system_info(id)` | 시스템 정보 조회 |

## 9. 주의사항 및 권장사항

### 9.1 하드웨어 연결
- ✅ 안정된 전원 공급 확보
- ✅ 적절한 안테나 배치
- ✅ 전자기 간섭 최소화
- ⚠️ COM 포트 번호 정확히 확인

### 9.2 소프트웨어 설정
- ✅ 적절한 FPS 설정 (데이터 처리 능력에 맞게)
- ✅ 버퍼 오버플로우 방지를 위한 주기적 클리어
- ✅ 예외 처리를 통한 안정적인 연결 관리
- ⚠️ 모듈 사용 후 반드시 연결 해제

### 9.3 데이터 처리
- ✅ 노이즈 필터링
- ✅ 적절한 윈도우 함수 적용
- ✅ 캘리브레이션 데이터 활용
- ⚠️ 실시간 처리 시 성능 고려

## 10. 트러블슈팅

### 10.1 연결 문제
**문제**: `ModuleConnector` 연결 실패
```
해결 방법:
1. COM 포트 번호 확인 (장치 관리자)
2. 드라이버 설치 확인
3. 다른 프로그램에서 포트 사용 중인지 확인
4. 케이블 연결 상태 점검
```

**문제**: 데이터 읽기 시 오류
```
해결 방법:
1. 모듈 리셋 후 재시도
2. FPS 값 낮춰서 테스트
3. 버퍼 클리어 후 재시도
```

### 10.2 성능 문제
**문제**: 실시간 플롯이 느림
```
해결 방법:
1. FPS 값 조정
2. 플롯 업데이트 간격 늘리기
3. 데이터 처리 로직 최적화
```

## 11. 확장 가능한 응용 분야

### 11.1 의료 분야
- 📊 비접촉 생체신호 모니터링
- 🫁 호흡량 및 호흡 패턴 분석
- 💓 심박수 변이도 측정
- 😴 수면 상태 모니터링

### 11.2 보안 및 모니터링
- 🚪 침입 감지 시스템
- 👥 인원 카운팅
- 🏃 활동량 측정
- 📍 위치 추적

### 11.3 스마트홈
- 🏠 재실 감지
- 🌡️ 환경 제어 자동화
- 👶 베이비 모니터링
- 👴 노인 돌봄 시스템

## 12. 결론

X4M06 레이더 모듈은 Python PyModuleConnector 라이브러리를 통해 효율적으로 제어할 수 있으며, 제공된 샘플 코드들은 다양한 응용 분야에 맞게 잘 구성되어 있습니다. 실시간 데이터 수집, 녹화/재생, 시스템 진단 등의 기능을 통해 생체 신호 감지, 움직임 모니터링, 거리 측정 등의 다양한 애플리케이션을 개발할 수 있습니다.

성공적인 구현을 위해서는 하드웨어 설정, 파라미터 튜닝, 신호 처리 알고리즘의 최적화가 중요하며, 제공된 샘플 코드를 기반으로 특정 용도에 맞게 커스터마이징하는 것을 권장합니다.

---

**문서 작성일**: 2025년 9월 26일  
**분석 대상**: X4M06 레이더 모듈 및 Python 샘플 코드  
**작성자**: AI 레이더 전문가