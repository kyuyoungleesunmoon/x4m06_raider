# X4M06 레이더 실험 실행 가이드 - 단계별 명령어

## 🚀 빠른 실행 가이드

### 전체 자동 실행 (권장)
```bash
# 모든 단계 한번에 실행
python main_experiment.py --mode all --samples 1000 --device COM3 --frames 1000
```

### 단계별 실행
```bash
# 1단계만 실행
python main_experiment.py --mode simulation --samples 1000

# 2단계만 실행 (USB 연결 필요)
python main_experiment.py --mode hardware --device COM3 --frames 1000

# 3단계만 실행
python main_experiment.py --mode analysis --dataset experiment_results/session_*/simulation/*.h5
```

---

## 📋 1단계: 시뮬레이션 실험 상세 절차

### 목표
- ✅ 1000개 샘플의 합성 레이더 데이터셋 생성
- ✅ Clean vs Jammed 신호 스펙트로그램 시각화
- ✅ 딥러닝 학습용 HDF5 데이터셋 구축

### 실행 명령어
```bash
cd C:\X4M06_레이더
python main_experiment.py --mode simulation --samples 1000
```

### 예상 실행 시간
- **소요 시간**: 약 15-30초
- **메모리 사용량**: ~2GB
- **디스크 사용량**: ~50MB

### 출력 예시
```
==================================================
시뮬레이션 기반 실험 시작
==================================================

1. 레이더 시뮬레이터 초기화...
2. 샘플 시각화 생성...
3. 합성 데이터셋 생성 (1000개 샘플)...
데이터셋 생성 중: 100%|████████████| 999/999 [00:12<00:00, 81.23it/s]

✅ 시뮬레이션 실험 완료!
데이터셋: experiment_results/session_20250927_190149/simulation/radar_jamming_dataset_1000.h5
```

### 생성 결과 확인
```bash
# 생성된 파일 확인
ls experiment_results/session_*/simulation/

# HDF5 데이터셋 구조 분석
python analyze_hdf5.py
```

---

## 🔌 2단계: 하드웨어 실험 상세 절차

### 목표
- ✅ X4M06 레이더 모듈과 USB 통신 확립
- ✅ 실제 환경에서 베이스라인 데이터 수집
- ✅ 시뮬레이션 모델 검증용 실측 데이터 확보

### 사전 준비
1. **하드웨어 연결**
   - X4M06 모듈을 USB 케이블로 PC에 연결
   - Device Manager에서 인식 확인
   - COM 포트 번호 확인 (예: COM3)

2. **연결 테스트**
```bash
# 연결 상태 확인
python x4m06_data_collector.py --test-connection --device COM3
```

### 실행 명령어
```bash
# 베이스라인 데이터 수집 (재밍 없음)
python main_experiment.py --mode hardware --device COM3 --frames 1000
```

### 예상 실행 시간
- **소요 시간**: 약 2-5분
- **수집 데이터**: 1000 프레임
- **샘플링 레이트**: 실시간 수집

### 출력 예시
```
==================================================
하드웨어 기반 실험 시작
==================================================

1. X4M06 모듈 연결 중... (COM3)
2. 베이스라인 데이터 수집 시작...
데이터 수집: 100%|████████████| 1000/1000 [02:15<00:00, 7.41frame/s]

✅ 하드웨어 실험 완료!
데이터셋: experiment_results/session_20250927_191234/hardware/hardware_baseline_data.h5
```

### 트러블슈팅
```bash
# COM 포트 스캔
python x4m06_data_collector.py --scan-ports

# 드라이버 재설치가 필요한 경우
# Device Manager → Unknown Device → Update Driver
```

---

## 📈 3단계: 통합 분석 상세 절차

### 목표
- ✅ 시뮬레이션과 하드웨어 데이터 비교 분석
- ✅ 논문용 시각화 자료 생성
- ✅ 성능 메트릭 계산 및 종합 평가

### 실행 명령어
```bash
# 자동 데이터셋 경로 탐지 및 분석
python main_experiment.py --mode analysis

# 또는 수동 경로 지정
python main_experiment.py --mode analysis \
  --dataset experiment_results/session_20250927_190149/simulation/radar_jamming_dataset_1000.h5
```

### 상세 분석 옵션
```bash
# 논문용 시각화 생성
python create_paper_figures.py --output-dir paper_figures/

# 성능 메트릭 계산
python data_analyzer.py --comprehensive-analysis

# 상관관계 분석
python correlation_analyzer.py --sim-hw-comparison
```

### 예상 실행 시간
- **소요 시간**: 약 1-3분
- **생성 파일**: 4개 PNG 이미지 + 분석 리포트
- **메모리 사용량**: ~1GB

---

## 🎯 결과 검증 체크리스트

### 1단계 검증
```bash
# 파일 크기 확인 (약 50MB)
ls -lh experiment_results/session_*/simulation/radar_jamming_dataset_1000.h5

# 데이터 구조 확인
python -c "
import h5py
f = h5py.File('experiment_results/session_*/simulation/radar_jamming_dataset_1000.h5', 'r')
print('Datasets:', list(f.keys()))
print('Clean signals shape:', f['clean_signals'].shape)
print('Jammed signals shape:', f['jammed_signals'].shape)
f.close()
"

# 시각화 이미지 확인
start experiment_results/session_*/simulation/sample_visualization.png
```

### 2단계 검증
```bash
# 하드웨어 데이터 파일 확인
ls -lh experiment_results/session_*/hardware/

# 수집 프레임 수 확인
python -c "
import h5py
f = h5py.File('experiment_results/session_*/hardware/hardware_baseline_data.h5', 'r')
print('Hardware data shape:', f['radar_data'].shape)
f.close()
"
```

### 3단계 검증
```bash
# 생성된 논문 시각화 확인
ls paper_figures/
# 예상 파일:
# - figure1_target_characteristics.png
# - figure2_jamming_characteristics.png
# - figure3_signal_comparison.png
# - figure4_summary_statistics.png

# 분석 리포트 확인
ls X4M06_레이더_분석_리포트.*
```

---

## ⚡ 성능 최적화 팁

### 메모리 최적화
```bash
# 샘플 수를 줄여서 테스트
python main_experiment.py --mode simulation --samples 100

# 배치 크기 조정
python main_experiment.py --mode simulation --samples 1000 --batch-size 50
```

### 속도 최적화
```bash
# 멀티프로세싱 사용
python main_experiment.py --mode simulation --samples 1000 --workers 4

# 빠른 분석 모드
python main_experiment.py --mode analysis --quick-mode
```

### 디스크 공간 절약
```bash
# 압축 저장 형식 사용
python main_experiment.py --mode simulation --samples 1000 --format npz

# 임시 파일 정리
python cleanup_temp_files.py
```

---

## 🔧 고급 설정 옵션

### 사용자 정의 설정 파일 사용
```bash
# config.json 파일 생성
cat > config.json << EOF
{
  "simulation": {
    "radar_config": {
      "center_freq": 8.748e9,
      "bandwidth": 1.4e9,
      "num_samples": 2000
    },
    "stft_params": {
      "nperseg": 512,
      "noverlap": 256
    }
  }
}
EOF

# 사용자 정의 설정으로 실행
python main_experiment.py --mode simulation --config config.json
```

### 출력 디렉토리 지정
```bash
# 특정 디렉토리에 결과 저장
python main_experiment.py --mode simulation --samples 1000 \
  --output-dir custom_results/
```

### 로그 레벨 조정
```bash
# 상세 로그 출력
python main_experiment.py --mode simulation --samples 1000 --verbose

# 조용한 모드 (에러만 출력)
python main_experiment.py --mode simulation --samples 1000 --quiet
```

---

## 📊 데이터 활용 예시

### Python에서 HDF5 데이터 로드
```python
import h5py
import numpy as np

# 데이터셋 로드
with h5py.File('experiment_results/session_*/simulation/radar_jamming_dataset_1000.h5', 'r') as f:
    clean_signals = f['clean_signals'][:]
    jammed_signals = f['jammed_signals'][:]
    clean_spectrograms = f['clean_spectrograms'][:]
    jammed_spectrograms = f['jammed_spectrograms'][:]

print(f"Clean signals: {clean_signals.shape}")
print(f"Jammed signals: {jammed_signals.shape}")
print(f"Clean spectrograms: {clean_spectrograms.shape}")
print(f"Jammed spectrograms: {jammed_spectrograms.shape}")
```

### 딥러닝 모델 학습 준비
```python
import torch
from torch.utils.data import DataLoader, TensorDataset

# PyTorch 텐서로 변환
clean_tensor = torch.from_numpy(clean_spectrograms)
jammed_tensor = torch.from_numpy(jammed_spectrograms)

# 데이터셋 및 데이터로더 생성
dataset = TensorDataset(jammed_tensor, clean_tensor)
dataloader = DataLoader(dataset, batch_size=32, shuffle=True)
```

---

## 🆘 문제 해결 FAQ

### Q1: "scipy.fft.stft를 찾을 수 없다" 오류
```bash
A: scipy 버전 업데이트 필요
pip install --upgrade scipy>=1.7.0
```

### Q2: 한글 폰트가 깨져 보임
```bash
A: Malgun Gothic 폰트 설치 및 matplotlib 설정
python -c "import matplotlib.pyplot as plt; plt.rcParams['font.family'] = 'Malgun Gothic'"
```

### Q3: X4M06 USB 연결이 안됨
```bash
A: 드라이버 및 포트 확인
1. Device Manager에서 Unknown Device 확인
2. X4M06 드라이더 재설치
3. 다른 USB 포트 시도
4. USB 케이블 교체
```

### Q4: 메모리 부족 오류
```bash
A: 샘플 수 감소 또는 배치 크기 조정
python main_experiment.py --mode simulation --samples 500 --batch-size 25
```

### Q5: 실행 시간이 너무 오래 걸림
```bash
A: 멀티프로세싱 및 최적화 옵션 사용
python main_experiment.py --mode simulation --samples 1000 --workers 4 --optimize
```

---

## 📞 지원 및 문의

- **GitHub**: [kyuyoungleesunmoon/x4m06_raider](https://github.com/kyuyoungleesunmoon/x4m06_raider)
- **Issues**: [GitHub Issues 페이지](https://github.com/kyuyoungleesunmoon/x4m06_raider/issues)
- **문서**: 프로젝트 `README.md` 및 `docs/` 디렉토리 참조